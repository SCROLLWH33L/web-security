{% macro csrf_post(req) %}
<form action="{{ req.url | e}}" method="{{ req.method | e }}">
    {% for name, value in req.data.items() %}
        <input type="hidden" name="{{ name | e }}" value="{{ value | e }}">
    {% endfor %}
</form>
<script>
    document.forms[0].submit();
</script>
{% endmacro %}